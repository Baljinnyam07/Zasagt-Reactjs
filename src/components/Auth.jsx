import { useEffect, useState } from 'react';
import { auth } from '../firebase';
import { sendPasswordResetEmail, signInWithEmailAndPassword } from 'firebase/auth';
import { useAuthState } from 'react-firebase-hooks/auth';
import { Link, useNavigate } from 'react-router-dom';
import backImage from './authBackImage.jpg'

const Auth = () => {
  const [user] = useAuthState(auth);
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [sending, setSending] = useState(false);
  const [error, setError] = useState('');
  const [success, setSuccess] = useState('');
  const navigate = useNavigate();
  const [showPassword] = useState(false);

  useEffect(() => {
    if (user) {
      navigate('/admin');
    }

    const timeout = setTimeout(() => {
      setError('');
      setSuccess('');
    }, 3000);

    return () => clearTimeout(timeout);
  }, [user, navigate, error, success]);

  const signInWithEmail = () => {
    setSending(true);
    setError('');
    setSuccess('');
    signInWithEmailAndPassword(auth, email, password)
      .then(() => {
        setSending(false);
        setSuccess('Successfully signed in with email!');
      })
      .catch((error) => {
        console.log(error);
        setSending(false);
        setError('Incorrect email or password');
      });
  }

  const handleKeyDownOnPassword = (event) => {
    if (event.key === 'Enter') {
      signInWithEmail();
    }
  }
  const handleResetPassword = () => {
    setSending(true);
    setError('');
    setSuccess('');
  
    sendPasswordResetEmail(auth, email)
      .then(() => {
        setSending(false);
        setSuccess('Password reset email sent. Please check your inbox.');
      })
      .catch((error) => {
        console.error(error);
        setSending(false);
        setError('Failed to send password reset email. Please try again.');
      });
  };

  return (
    <body className='flex h-screen relative' style={{backgroundImage: `url(${backImage})`, backgroundRepeat:'no-repeat', backgroundSize:'cover'}}>
      <div className="w-full max-w-xs m-auto bg-gray-300 rounded p-5">
        <header>
          <div className="w-20 mx-auto mb-5">
          <svg xmlns="http://www.w3.org/2000/svg" width="78" height="50" viewBox="0 0 78 50" fill="none">
          <g clipPath="url(#clip0_96_545)">
          <path d="M69.7863 10.8743C69.5872 11.7564 69.3989 12.5836 69.2143 13.4108C68.3491 17.2777 67.4857 21.1446 66.6224 25.0116C66.1427 27.1546 65.6595 29.2976 65.1943 31.4443C65.1364 31.7151 65.0151 31.7353 64.7979 31.6968C63.0676 31.3821 61.3372 31.071 59.605 30.758C59.5815 30.7544 59.558 30.7525 59.5344 30.7489C58.9245 30.6354 58.9444 30.6171 59.0946 30.0004C59.3951 28.776 59.6503 27.5407 59.9272 26.3091C60.4286 24.0709 60.9336 21.8346 61.4349 19.5964C61.4603 19.4811 61.4711 19.364 61.5001 19.1608C60.9698 19.2615 60.4829 19.3402 60.0032 19.4482C57.6937 19.9643 55.3841 20.4803 53.08 21.0184C52.7506 21.0952 52.5497 21.0074 52.327 20.7786C49.6935 18.0591 47.0527 15.3488 44.4119 12.6366C44.3142 12.536 44.2002 12.4555 44.0318 12.3127C44.0156 12.4829 43.9974 12.5817 43.9974 12.6806C43.9974 18.0903 43.9993 23.5 44.0029 28.9096C44.0029 29.4038 44.0083 29.4038 43.5069 29.4038C41.7295 29.4038 39.9539 29.4038 38.1765 29.4038C38.0353 29.4038 37.896 29.4038 37.7095 29.4038C37.7095 23.7159 37.7095 18.0628 37.7095 12.2798C37.4525 12.4847 37.2661 12.6019 37.1159 12.7556C34.5258 15.4184 31.9356 18.0793 29.3618 20.7585C29.0795 21.0513 28.8243 21.1026 28.4532 21.0165C26.703 20.6121 24.9473 20.2351 23.1952 19.8416C22.3246 19.6476 21.4576 19.4409 20.5888 19.245C20.4657 19.2176 20.339 19.2121 20.1526 19.1883C21.0033 23.0168 21.8413 26.7922 22.6848 30.5951C20.5653 30.9666 18.5471 31.3217 16.5054 31.6804C14.9525 24.7279 13.414 17.8359 11.8538 10.8413C12.5524 10.9731 13.1461 11.0664 13.7307 11.2C15.6909 11.6447 17.6476 12.1078 19.6078 12.5525C21.9499 13.0832 24.2975 13.5993 26.6396 14.1282C26.8767 14.1812 27.045 14.1263 27.2134 13.9506C29.6569 11.4306 32.1076 8.91794 34.5511 6.3961C36.4769 4.41047 38.3937 2.41569 40.3177 0.428237C40.4734 0.26719 40.649 0.122615 40.7811 0C41.4074 0.603924 42.0228 1.16942 42.6056 1.76602C46.4138 5.6659 50.2238 9.56762 54.0158 13.484C54.8466 14.3423 54.5298 14.2142 55.6592 13.9708C58.4846 13.3614 61.2992 12.7098 64.1192 12.0785C65.8368 11.6942 67.5545 11.3153 69.274 10.9365C69.4206 10.9036 69.5727 10.8981 69.7826 10.8743H69.7863Z" fill="#23356B"/>
          <path d="M5.5603 36.4202C7.25627 35.6168 8.97757 34.9031 10.7695 34.3577C13.1985 33.6184 15.6528 32.9998 18.147 32.5533C20.1615 32.1928 22.1815 31.8579 24.2069 31.5797C27.6314 31.1094 31.0722 30.7543 34.5256 30.6756C38.5402 30.5841 42.5602 30.5622 46.5748 30.6665C49.4165 30.7397 52.2564 31.027 55.0908 31.2997C56.8664 31.4699 58.6348 31.7517 60.3941 32.0518C62.3507 32.3849 64.3091 32.7308 66.2386 33.1902C68.1228 33.6404 69.9762 34.2187 71.8314 34.7841C72.7401 35.0605 73.6197 35.4283 74.5102 35.7632C74.6605 35.82 74.7962 35.9133 74.9157 36.0597C74.4089 35.9774 73.9039 35.8895 73.3953 35.8163C70.4975 35.3936 67.6033 34.947 64.7019 34.5627C63.2629 34.3724 61.8077 34.2973 60.3615 34.1729C58.7977 34.0375 57.2338 33.8966 55.67 33.7758C54.9931 33.7245 54.3125 33.7136 53.6338 33.6916C49.7278 33.5671 45.8218 33.4226 41.914 33.3329C40.1276 33.2908 38.3357 33.3164 36.5492 33.3787C32.9292 33.5031 29.3074 33.6221 25.6929 33.8453C23.0123 34.01 20.3317 34.2717 17.6655 34.6103C14.2193 35.0477 10.7876 35.6022 7.34858 36.1128C6.75128 36.2006 6.1576 36.3214 5.56211 36.4257L5.5603 36.4202Z" fill="#211F20"/>
          <path d="M47.791 49.9593C48.4788 48.0066 49.1449 46.0448 49.8671 44.1049C50.0843 43.5211 50.0734 43.0288 49.8417 42.4542C49.1901 40.8364 48.5983 39.193 47.9829 37.5588C47.9412 37.449 47.9087 37.3355 47.858 37.1873C48.8209 37.1873 49.7512 37.1818 50.6816 37.1982C50.7558 37.1982 50.8662 37.3538 50.8952 37.4563C51.1938 38.5232 51.478 39.592 51.7947 40.7705C52.126 39.5133 52.4318 38.3567 52.7395 37.1964C53.7242 37.1964 54.6799 37.1964 55.6844 37.1964C55.5016 37.7125 55.3296 38.2048 55.1541 38.6971C54.6418 40.1245 54.1188 41.5501 53.621 42.9831C53.5577 43.1679 53.5613 43.415 53.6264 43.5998C54.2038 45.2469 54.8029 46.8866 55.3966 48.5282C55.4328 48.6289 55.4708 48.7277 55.5686 48.8283C56.1116 44.9541 56.6546 41.078 57.1976 37.2037C58.6238 37.2037 60.0085 37.2037 61.4167 37.2037C61.9397 40.7852 62.4592 44.3538 62.9805 47.9225C63.0094 47.9225 63.0366 47.9206 63.0656 47.9188C63.5651 44.3575 64.0629 40.7962 64.566 37.211C64.6837 37.2019 64.7851 37.1891 64.8882 37.1891C66.0738 37.1891 67.2575 37.1964 68.4431 37.1818C68.7146 37.1781 68.8032 37.2568 68.8431 37.535C69.2069 40.1026 69.5906 42.6665 69.9634 45.2341C70.1915 46.8098 70.4087 48.3855 70.6313 49.9611C69.6739 49.9611 68.7164 49.9611 67.7589 49.9611C67.6919 49.1834 67.6231 48.4038 67.5543 47.6004C67.1073 47.6004 66.7 47.6315 66.3 47.5912C65.9163 47.5528 65.8403 47.7285 65.8149 48.0597C65.7643 48.6947 65.6774 49.3279 65.605 49.9611C63.8819 49.9611 62.1569 49.9611 60.4338 49.9611C60.4157 49.8916 60.3868 49.8239 60.3813 49.7525C60.3252 49.1504 60.28 48.5483 60.2112 47.9481C60.1985 47.8291 60.1026 47.6241 60.0374 47.6223C59.5306 47.5949 59.022 47.6077 58.4971 47.6077C58.4211 48.4239 58.3505 49.1925 58.2799 49.9611C56.4844 49.9611 54.6889 49.9611 52.8934 49.9611C52.8753 49.8459 52.868 49.7251 52.8337 49.6134C52.6237 48.9253 52.4065 48.2391 52.1929 47.5528C52.0698 47.1557 51.9486 46.7585 51.8273 46.3614C51.5866 46.969 51.4056 47.5638 51.2354 48.1622C51.0653 48.7606 50.9024 49.3609 50.7377 49.9611C49.7567 49.9611 48.7738 49.9611 47.7928 49.9611L47.791 49.9593ZM59.9596 45.1536C59.8999 44.5551 59.8456 43.9933 59.7877 43.4296C59.6772 42.3627 59.5686 41.2939 59.4474 40.2288C59.4347 40.1227 59.3424 40.0257 59.2881 39.925C59.2356 40.0257 59.1505 40.1227 59.1379 40.2288C59.0872 40.6479 59.0582 41.0688 59.0238 41.4898C58.9225 42.7013 58.8247 43.9146 58.7216 45.1536C59.1288 45.1536 59.5162 45.1536 59.9596 45.1536ZM67.3335 45.1572C67.281 44.6503 67.234 44.1818 67.1869 43.7151C67.0656 42.5146 66.9462 41.3159 66.8159 40.1172C66.8086 40.0477 66.7145 39.9891 66.662 39.925C66.615 39.9818 66.5462 40.033 66.5263 40.0989C66.4919 40.2124 66.481 40.335 66.4702 40.4558C66.3978 41.3086 66.3272 42.1632 66.2584 43.0179C66.2023 43.7243 66.1498 44.4307 66.0937 45.159C66.519 45.159 66.9064 45.159 67.3317 45.159L67.3335 45.1572Z" fill="#08090B"/>
          <path d="M31.1265 49.9592C31.1265 45.7171 31.1265 41.4768 31.1265 37.2109C35.0831 37.2109 39.009 37.2109 42.9602 37.2109C42.9602 37.9942 42.9602 38.772 42.9602 39.5882C42.5331 39.5882 42.1168 39.6065 41.7041 39.5827C41.4145 39.5662 41.3439 39.6669 41.3457 39.9524C41.3566 43.133 41.3529 46.3119 41.3511 49.4925C41.3511 49.6481 41.3366 49.8055 41.3276 49.961C40.3701 49.961 39.4126 49.961 38.4551 49.961C38.4569 46.5644 38.4606 43.1678 38.4624 39.7712C38.4624 39.7163 38.4388 39.6614 38.4171 39.5681C37.8741 39.5681 37.342 39.5681 36.7881 39.5681C36.7881 38.8763 36.7881 38.2285 36.7881 37.5788C36.77 37.5788 36.7537 37.5788 36.7356 37.5788C36.7356 38.2394 36.7356 38.8983 36.7356 39.5955C35.818 39.5955 34.9256 39.5955 34.0025 39.5955C34.0025 43.0763 34.0025 46.5187 34.0025 49.961C33.0451 49.961 32.0876 49.961 31.1301 49.961L31.1265 49.9592Z" fill="#08090B"/>
          <path d="M71.1328 49.9593C71.1256 49.8514 71.1111 49.7434 71.1111 49.6354C71.1111 45.5836 71.1111 41.5337 71.1111 37.4819C71.1111 37.3995 71.1201 37.3154 71.1256 37.2092C72.074 37.2092 73.0152 37.2092 74.0016 37.2092C74.0016 38.913 74.0016 40.6205 74.0016 42.3535C74.4252 42.3535 74.8017 42.3535 75.2089 42.3535C75.2089 40.6315 75.2089 38.9313 75.2089 37.1836C76.1935 37.1836 77.1456 37.1836 78.0995 37.1836C78.0995 41.4422 78.0995 45.7007 78.0995 49.9575C77.142 49.9575 76.1845 49.9575 75.227 49.9575C75.227 48.2464 75.227 46.5334 75.227 44.8223C74.789 44.8223 74.4125 44.8223 74.0053 44.8223C74.0053 46.5517 74.0053 48.2555 74.0053 49.9575C73.0478 49.9575 72.0903 49.9575 71.1328 49.9575V49.9593Z" fill="#08090B"/>
          <path d="M7.35215 49.9593C7.47161 49.1614 7.5965 48.3653 7.71053 47.5674C7.9947 45.5745 8.27706 43.5797 8.5558 41.5849C8.7549 40.1648 8.95219 38.7428 9.14948 37.3227C9.15491 37.2879 9.16939 37.2568 9.18387 37.2056C10.5685 37.2056 11.9532 37.2056 13.3794 37.2056C13.4989 38.0181 13.6184 38.8362 13.7396 39.6542C14.0202 41.563 14.3007 43.4699 14.5795 45.3787C14.8039 46.9049 15.0265 48.4331 15.251 49.9593C14.2935 49.9593 13.336 49.9593 12.3785 49.9593C12.3007 49.1852 12.221 48.4111 12.1396 47.6022C11.6237 47.6022 11.126 47.5949 10.6282 47.6114C10.5649 47.6132 10.4581 47.734 10.4491 47.809C10.364 48.5246 10.297 49.2419 10.2228 49.9593C9.26532 49.9593 8.30783 49.9593 7.35034 49.9593H7.35215ZM11.9278 45.1554C11.7577 43.4772 11.5948 41.8265 11.4174 40.1758C11.4083 40.0879 11.2979 40.0092 11.2346 39.9269C11.1857 40.0239 11.1043 40.1154 11.0952 40.216C11.0174 41.0432 10.9486 41.8722 10.8835 42.7013C10.8183 43.5138 10.7604 44.3282 10.697 45.1554C11.1224 45.1554 11.5079 45.1554 11.9278 45.1554Z" fill="#08090B"/>
          <path d="M22.8674 49.9591C22.9978 48.9562 23.1208 47.9515 23.2584 46.9486C23.5082 45.1222 23.7652 43.2958 24.0222 41.4694C24.2195 40.0621 24.4204 38.6547 24.6249 37.2163C26.0168 37.2163 27.4087 37.2163 28.8422 37.2163C28.9291 37.791 29.0232 38.3821 29.1083 38.975C29.4106 41.0503 29.711 43.1256 30.0115 45.2009C30.2413 46.7876 30.4676 48.3743 30.6957 49.9591C29.7382 49.9591 28.7807 49.9591 27.8232 49.9591C27.7526 49.1813 27.682 48.4035 27.6114 47.6166C27.0395 47.6166 26.5055 47.6166 25.9444 47.6166C25.8521 48.4072 25.7598 49.1831 25.6693 49.9591C24.7353 49.9591 23.8014 49.9591 22.8674 49.9591ZM27.3997 45.1606C27.2295 43.5575 27.0684 42.0001 26.8947 40.4446C26.8748 40.267 26.777 40.0987 26.7155 39.9266C26.6539 40.1042 26.5544 40.278 26.5363 40.4592C26.4331 41.5517 26.3444 42.6443 26.2576 43.7387C26.2195 44.2108 26.1942 44.6867 26.1616 45.1625C26.5996 45.1625 26.9779 45.1625 27.3978 45.1625L27.3997 45.1606Z" fill="#08090B"/>
          <path d="M17.6239 49.9595C17.0393 49.4251 16.4583 48.8852 15.8664 48.36C15.6836 48.1971 15.6003 48.0287 15.6003 47.7725C15.6094 44.978 15.6094 42.1835 15.6003 39.389C15.6003 39.1383 15.6637 38.9607 15.8447 38.7887C16.3533 38.3111 16.842 37.8133 17.3488 37.3356C17.4339 37.2551 17.5732 37.1929 17.6891 37.1911C18.5995 37.1801 19.5081 37.1783 20.4185 37.1911C20.5471 37.1911 20.7009 37.2569 20.795 37.343C21.3435 37.8481 21.8792 38.366 22.4114 38.8875C22.4892 38.9644 22.5634 39.087 22.5652 39.1913C22.5761 40.1448 22.5724 41.1001 22.5724 42.0828C21.6258 42.0828 20.7009 42.0828 19.7362 42.0828C19.7362 41.2557 19.7362 40.4394 19.7362 39.6049C19.3072 39.6049 18.9181 39.6049 18.5054 39.6049C18.5054 42.2457 18.5054 44.8774 18.5054 47.5328C18.8963 47.5328 19.2855 47.5328 19.7217 47.5328C19.7217 46.5464 19.7217 45.5508 19.7217 44.5278C20.6828 44.5278 21.5987 44.5278 22.5507 44.5278C22.558 44.623 22.5706 44.7273 22.5706 44.8298C22.5706 45.8217 22.5815 46.8136 22.5616 47.8055C22.558 47.9738 22.4711 48.1806 22.3534 48.3014C21.8937 48.7754 21.4032 49.222 20.929 49.6831C20.8457 49.7637 20.7824 49.8643 20.71 49.9576C19.6801 49.9576 18.6502 49.9576 17.6221 49.9576L17.6239 49.9595Z" fill="#08090B"/>
          <path d="M1.75017 49.9601C1.40809 49.5813 1.10401 49.1548 0.716668 48.8346C0.16824 48.3826 -0.0743001 47.8646 0.0198196 47.1491C0.0741194 46.7337 0.0288695 46.3054 0.0288695 45.8534C0.933867 45.8534 1.82257 45.8534 2.76015 45.8534C2.76015 46.4042 2.76015 46.9642 2.76015 47.5425C3.18369 47.5425 3.56017 47.5425 3.96561 47.5425C3.96561 46.611 3.96561 45.6887 3.96561 44.7316C3.45881 44.7316 2.96287 44.7316 2.43978 44.7316C2.43978 43.9172 2.43978 43.1376 2.43978 42.3122C2.9502 42.3122 3.45881 42.3122 3.97466 42.3122C3.97466 41.3862 3.97466 40.5096 3.97466 39.611C3.57827 39.611 3.20179 39.611 2.77825 39.611C2.77825 40.1271 2.77825 40.6395 2.77825 41.1757C1.84429 41.1757 0.955587 41.1757 0.0306798 41.1757C0.0306798 40.484 0.0252496 39.8087 0.0361096 39.1352C0.0361096 39.0547 0.1067 38.9613 0.170049 38.8973C0.669608 38.3776 1.16917 37.8578 1.68682 37.3564C1.78456 37.2612 1.9547 37.199 2.09407 37.1972C2.94296 37.1825 3.79185 37.1862 4.64255 37.1972C4.7602 37.1972 4.90499 37.2411 4.99187 37.3179C5.5584 37.8194 6.1195 38.3281 6.66069 38.8552C6.78015 38.9723 6.87427 39.1773 6.87789 39.3438C6.89961 40.1765 6.8978 41.0129 6.87789 41.8455C6.87427 41.9883 6.78739 42.1676 6.6806 42.2646C6.21543 42.6782 5.72854 43.068 5.20726 43.5018C5.67424 43.8769 6.11045 44.2484 6.56657 44.5906C6.80006 44.7645 6.89961 44.9548 6.89237 45.255C6.87246 46.0767 6.87608 46.8984 6.89237 47.7201C6.8978 47.9964 6.81454 48.1959 6.61363 48.3844C6.06158 48.9005 5.52582 49.4367 4.98282 49.9656C3.90588 49.9656 2.82893 49.9656 1.75017 49.9656V49.9601Z" fill="#08090B"/>
          </g>
          <defs>
          <clipPath id="clip0_96_545">
          <rect width="78" height="50" fill="white"/>
          </clipPath>
          </defs>
          </svg>
          </div>
        </header>
        <form>
          <div>
            <label className="block mb-2 text-gray-500" htmlFor="username">
              Email Address
            </label>
            <input
              className="w-full p-2 mb-6 text-gray-500 border-b-2 border-[#23356B] outline-none focus:bg-gray-300"
              type="text"
              name="username"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              onKeyDown={handleKeyDownOnPassword}
              placeholder='You@example.com'
            />
          </div>
          <div>
            <label className="block mb-2 text-gray-500" htmlFor="password">
              Password
            </label>
            <input
              className="w-full p-2 mb-6 text-indigo-700 border-b-2 border-[#23356B] outline-none focus:bg-gray-300"
              type={showPassword ? 'text' : 'password'}
              name="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              onKeyDown={handleKeyDownOnPassword}
              placeholder='Enter your password'
            />
          </div>
          <div>
             <button
             className="w-full bg-[#23356B] hover:bg-pink-700 text-white font-bold py-2 px-4 mb-6 rounded"
             type="button"
             onClick={signInWithEmail}
             disabled={sending}
           >
             {sending ? 'Signing In...' : 'Sign In'}
           </button>
          </div>
        </form>
        <footer>
          <Link className="text-gray-500 hover:text-pink-700 text-sm float-left" href="#" onClick={handleResetPassword}>Forgot Password?</Link>
        </footer>
        <div>
        </div>
      </div>
      <div className='absolute right-10 top-6'>123</div>
    </body>
  );
}

export default Auth;